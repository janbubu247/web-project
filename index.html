<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air Quality Monitoring Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
<link rel="stylesheet" href="css/style.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

</head>
<body>
<header class="header">
    <a href="#" class="logo" alt="">
        <img src="images/logo2.png" width="60px" height="80px" alt="">
    </a>

    <nav class="navbar">
        <a href="./forecast.html"><span class="material-symbols-outlined">rainy</span>compare</a>
        <a href="./chart.html"><span class="material-symbols-outlined">query_stats</span>weather data</a>
        <a href="./pollutants.html"><span class="material-symbols-outlined">bar_chart</span>pollutants</a>
        <a href="./products.html"><span class="material-symbols-outlined">shopping_bag</span>shopping</a>
        <a href="./signup.html"><span class="material-symbols-outlined">contacts</span>sign up</a>
        <a href="./about.html"><span class="material-symbols-outlined">lightbulb</span>about</a>
    </nav>
    <div class="icons">
        <div class="fas fa-bars" id="menu-btn"></div>
    </div>
</div>
</header>
<section class="menu">
<h1 class="heading">Air Quality <span>display</span> </h1>
</section>
<section class="charts">
    <h1 id="Home" class="heading">Air Quality <span>Display</span></h1>
    <hr>
    <div class="location">
        <input type="text" class="search-bar" id="location" placeholder="Search for location">
        <button type="button" class="btn" id="search" onclick="fetchInfo()">Search</button>
    </div>
    
    <div class="wrapper">
        <div class="box-container-today">
            <div class="box_day_today">
                <div id="resultDisplayArea"></div>
                <span id="lat"></span><br>
                <span id="lon"></span>
                <h1 id="date0"></h1>
                <span id="icon0"></span>
                <div class="weather-details">
                    <div class="detail">
                        <span class="material-symbols-outlined">thermostat</span>
                        <div>Temperature</div>
                        <div id="temperature0">°C</div>
                    </div>
                    <div class="detail">
                        <span class="material-symbols-outlined">humidity_percentage</span>
                        <div>Humidity</div>
                        <div id="humidity0">%</div>
                    </div>
                    <div class="detail">
                        <span class="material-symbols-outlined">wind_power</span>
                        <div>Wind</div>
                        <div id="wind_speed0">m/s</div>
                    </div>
                    <div class="detail">
                        <span class="material-symbols-outlined">blood_pressure</span>
                        <div>Pressure</div>
                        <div id="pressure0">hPa</div>
                    </div>
                    <div class="detail">
                        <div id="main0"></div>
                    </div>
                    <div class="detail">
                        <div id="description0"></div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Image Carousel -->
        <div class="image-container">
            <div class="carousel">
                <img src="images/agaar.jpeg" alt="Weather Image 1" class="carousel-image active">
                <img src="images/co_2.jpg" alt="Weather Image 2" class="carousel-image">
                <img src="images/warning.jpg" alt="Weather Image 3" class="carousel-image">
                <img src="images/rainbow.jpg" alt="Weather Image 3" class="carousel-image">
                <img src="images/humidity.jpeg" alt="Weather Image 3" class="carousel-image">
                <img src="images/hot.jpeg" alt="Weather Image 3" class="carousel-image">
                <img src="images/thunder.png" alt="Weather Image 3" class="carousel-image">
            </div>
            <div class="carousel-buttons">
                <button id="prev">❮</button>
                <button id="next">❯</button>
            </div>
        </div>
    </div>
    
    <section class="box-container-days hidden">
    <div class="box-container-day">
        
        <div class="box_day">
            <div id="date1"></div>
            <div id="description1"></div>
            <span id="icon1"></span>
            <div id="temperature1"></div>
        </div>
        <div class="box_day">
            <div id="date2"></div>
            <div id="description2"></div>
            <span id="icon2"></span>
            <div id="temperature2"></div>
        </div>
        <div class="box_day">
            <div id="date3"></div>
            <div id="description3"></div>
            <span id="icon3"></span>
            <div id="temperature3"></div>
        </div>
        <div class="box_day">
            <div id="date4"></div>
            <div id="description4"></div>
            <span id="icon4"></span>
            <div id="temperature4"></div>
        </div>
        <div class="box_day">
            <div id="date5"></div>
            <div id="description5"></div>
            <span id="icon5"></span>
            <div id="temperature5"></div>
        </div>
        <div class="box_day">
            <div id="date6"></div>
            <div id="description6"></div>
            <span id="icon6"></span>
            <div id="temperature6"></div>
        </div>
    </div>
    </section>
    <br>

    <!-- <div id="map1" style="height: 500px; margin-top: 20px;"></div> -->
    <iframe 
        id="map" 
        width="100%" 
        height="450" 
        style="border:0;" 
        allowfullscreen="" 
        loading="lazy" 
        referrerpolicy="no-referrer-when-downgrade">
    </iframe>
    
</div>
</section>

<section class="menu" id="menu">    
    <div>  
        <div class="box_container_hidden">
            <div class="box">
                <div id="date0"></div>
                <div id="main0"><span id="icon_main0"></span></div>
                <div id="description0"></div>
                <div id="clouds0"></div>
                <div id="temperature0"></div>
                <div id="humidity0"></div>
                <div id="pressure0"></div>
                <div id="wind_speed0"></div>
                <div id="wind_deg0"></div>
            </div>
            <div class="box">
                <div id="date1"></div>
                <div id="main1"><span id="icon_main1"></span></div>
                <div id="description1"></div>
                <div id="clouds1"></div>
                <div id="temperature1"></div>
                <div id="humidity1"></div>
                <div id="pressure1"></div>
                <div id="wind_speed1"></div>
                <div id="wind_deg1"></div>
            </div>
        
            <span class="box">
                <div id="date2"></div>
                <div id="main2"><span id="icon_main2"></span></div>
                <div id="description2"></div>
                <div id="clouds2"></div>
                <div id="temperature2"></div>
                <div id="humidity2"></div>
                <div id="pressure2"></div>
                <div id="wind_speed2"></div>
                <div id="wind_deg2"></div>
            </span>
            <span class="box">
                <div id="date3"></div>
                <div id="main3"><span id="icon_main3"></span></div>
                <div id="description3"></div>
                <div id="clouds3"></div>
                <div id="temperature3"></div>
                <div id="humidity3"></div>
                <div id="pressure3"></div>
                <div id="wind_speed3"></div>
                <div id="wind_deg3"></div>
            </span>
            <span class="box">
                <div id="date4"></div>
                <div id="main4"><span id="icon_main4"></span></div>
                <div id="description4"></div>
                <div id="clouds4"></div>
                <div id="temperature4"></div>
                <div id="humidity4"></div>
                <div id="pressure4"></div>
                <div id="wind_speed4"></div>
                <div id="wind_deg4"></div>
            </span>
            <span class="box">
                <div id="date5"></div>
                <div id="main5"><span id="icon_main5"></span></div>
                <div id="description5"></div>
                <div id="clouds5"></div>
                <div id="temperature5"></div>
                <div id="humidity5"></div>
                <div id="pressure5"></div>
                <div id="wind_speed5"></div>
                <div id="wind_deg5"></div>
            </span>
            <span class="box">
                <div id="date6"></div>
                <div id="main6"><span id="icon_main6"></span></div>
                <div id="description6"></div>
                <div id="clouds6"></div>
                <div id="temperature6"></div>
                <div id="humidity6"></div>
                <div id="pressure6"></div>
                <div id="wind_speed6"></div>
                <div id="wind_deg6"></div>
            </span>
            <span class="box">
                <div id="date7"></div>
                <div id="main7"><span id="icon_main7"></span></div>
                <div id="description7"></div>
                <div id="clouds7"></div>
                <div id="temperature7"></div>
                <div id="humidity7"></div>
                <div id="pressure7"></div>
                <div id="wind_speed7"></div>
                <div id="wind_deg7"></div>
            </span>
        </div>
        <!-- < special hidden part end > -->
    </div>
</section>
<!-- menu section ends-->



<!-- footer section starts  -->
<section class="footer">
    <div class="share">
        <a href="https://www.facebook.com/" class="fab fa-facebook-f"></a>
        <a href="https://x.com/" class="fab fa-twitter"></a>
        <a href="https://www.instagram.com/" class="fab fa-instagram"></a>
        <a href="https://www.linkedin.com/" class="fab fa-linkedin"></a>
        <a href="https://www.github.com/" class="fab fa-github"></a>
    </div>
    <img src="images/PNU.png" alt="PNU" width="70px">
    <div class="credit">created by <span style="color: black;">Janbubu</span></div>
    
</section>
<!-- footer section ends  -->
<script src="js/script.js" type="module"></script>
</body>
<script>
    
let lat;
let lon
function fetchInfo() {
  const location = document.getElementById("location").value;
  const apiKeyWeather = '1992acd757593192e5b6ed69c774d2f2';

  if (location) {
      const locationURL = `http://api.openweathermap.org/geo/1.0/direct?q=${location}&appid=${apiKeyWeather}`;

      $.ajax({
          method: "GET",
          url: locationURL,
      }).done(function(locationData) {
          if (locationData && locationData.length > 0) {
              lat = locationData[0].lat;
              lon = locationData[0].lon;

              document.getElementById("lat").innerHTML = `latitude: ${lat}`;
              document.getElementById("lon").innerHTML = `longitude: ${lon}`;
              document.querySelector('.box-container-days').classList.remove('hidden');
              updateMap(lat, lon)
              const weatherURL = `https://api.openweathermap.org/data/2.5/forecast/daily?lat=${lat}&lon=${lon}&appid=${apiKeyWeather}`;

              $.ajax({ method: "GET", url: weatherURL })
              .done(function(weatherData) {
                  //createPie(weatherData)
                  //createLine(weatherData)
                  
                  weatherData.list.forEach(function(forecast, index) {
                      const date = forecast.dt;
                      const temp = Math.round(forecast.temp.day-273,2);
                      const humidity = forecast.humidity;
                      const pressure = forecast.pressure;
                      const wind_speed = forecast.speed;
                      const wind_deg = forecast.deg;
                      const main = forecast.weather[0].main || "";
                      const description = forecast.weather[0].description || "";
                      const clouds = forecast.clouds || "";
                      switch (main) {
                        case "Light Snow":
                            document.getElementById(`icon${index}`).innerHTML = `<span class="material-symbols-outlined">snowing</span>`;
                            break;
                        case "Rain":
                            document.getElementById(`icon${index}`).innerHTML = `<span class="material-symbols-outlined">rainy</span>`;
                            break;
                        case "Clear":
                            document.getElementById(`icon${index}`).innerHTML = `<span class="material-symbols-outlined">sunny</span>`;
                            break;
                        case "Clouds":
                            document.getElementById(`icon${index}`).innerHTML = `<span class="material-symbols-outlined">cloudy</span>`;
                            break;
                        default:
                            document.getElementById(`icon${index}`).innerHTML = `<span class="material-symbols-outlined">help</span>`; // Fallback icon
                    }




                      document.getElementById(`date${index}`).innerHTML = `${getDayOfWeek(date)}`;  
                      document.getElementById(`main${index}`).innerHTML = `${main}`;
                      document.getElementById(`description${index}`).innerHTML = `${description}`;
                      document.getElementById(`clouds${index}`).innerHTML = `${clouds}%`;
                      document.getElementById(`temperature${index}`).innerHTML = `${temp}°C`;
                      document.getElementById(`humidity${index}`).innerHTML = `${humidity}%`;
                      document.getElementById(`pressure${index}`).innerHTML = `${pressure}hPa`;
                      document.getElementById(`wind_speed${index}`).innerHTML = `${wind_speed}m/s`;
                      document.getElementById(`wind_deg${index}`).innerHTML = `${wind_deg}°`;
                  });
              }).fail(function(jqXHR, textStatus) {
                  alert(`Failed to retrieve weather data: ${textStatus}`);
              });
          } else {
              alert("Location not found. Please try a different location.");
          }
      }).fail(function(jqXHR, textStatus) {
          alert(`Failed to retrieve location: ${textStatus}`);
      });
  } else {
      alert("Please enter a location name.");
  }
}
function getDayOfWeek(unixTimestamp) {
    const date = new Date(unixTimestamp * 1000); // Convert to milliseconds
    const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    return daysOfWeek[date.getDay()];
}

// Example usage
const dateString = "2024-12-05 09:00:00";
const dayOfWeek = getDayOfWeek(dateString);
console.log(dayOfWeek); // Output: "Thursday"

let map;     
function updateMap(lat, lon) {
    // Update the Google Maps iframe src attribute with new coordinates
    const mapUrl = `https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d26069.64183785817!2d${lon}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2skr!4v1733122760995!5m2!1sen!2skr`;
    document.getElementById('map').src = mapUrl;
}

// Fetch location information and air quality data based on user input
document.getElementById('search').addEventListener('click', function() {
    const location = document.getElementById("location").value.trim();

    if (!location) {
        document.getElementById("resultDisplayArea").innerHTML = "Please enter a valid location.";
        return;
    }

    // Geocode the location using Nominatim API
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`)
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                const place = data[0];
                lat = parseFloat(place.lat);
                lon = parseFloat(place.lon);

                // Display coordinates
                document.getElementById("lat").innerHTML = `${lat}`;
                document.getElementById("lon").innerHTML = `${lon}`;

                // Update the Google Maps iframe
                updateMap(lat, lon);

                document.getElementById("resultDisplayArea").innerHTML = `Location: ${place.display_name}`;
            } else {
                document.getElementById("resultDisplayArea").innerHTML = "Location not found. Please try another search.";
            }
        })
        .catch(error => {
            document.getElementById("resultDisplayArea").innerHTML = "Error fetching location data.";
            console.error('Error:', error);
        });
});
    

document.addEventListener("DOMContentLoaded", function () {
    const images = document.querySelectorAll(".carousel-image");
    let currentIndex = 0;

    // Show the first image initially
    images[currentIndex].classList.add("active");

    document.getElementById("next").addEventListener("click", function () {
        images[currentIndex].classList.remove("active");
        currentIndex = (currentIndex + 1) % images.length;
        images[currentIndex].classList.add("active");
    });

    document.getElementById("prev").addEventListener("click", function () {
        images[currentIndex].classList.remove("active");
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        images[currentIndex].classList.add("active");
    });
});
</script>

</html>